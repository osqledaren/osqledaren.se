var sam=sam||{};(function(n){var t,i=samEditorOptions.media;sam.media=t={buttonId:"#banner-media",adUrl:"#patch_img",adImgId:"#patch_img_id",adName:"#title",adDesc:"#description",init:function(){n(this.buttonId).on("click",this.openMediaDialog)},openMediaDialog:function(n){if(n.preventDefault(),this._frame){this._frame.open();return}this._frame=t.frame=wp.media({title:i.title,button:{text:i.button},multiple:!1,library:{type:"image"}});this._frame.on("ready",function(){});this._frame.state("library").on("select",function(){var n=this.get("selection").single();t.handleMediaAttachment(n)});this._frame.open()},handleMediaAttachment:function(t){var i=t.toJSON();n(this.adUrl).val(i.url);n(this.adImgId).val(i.id);""==n(this.adName).val()&&""!=i.title&&n(this.adName).val(i.title);""==n(this.adDesc).val()&&""!=i.caption&&n(this.adDesc).val(i.caption);""==n(this.adAlt).val()&&""!=i.alt&&n(this.adAlt).val(i.alt)}};n(document).ready(function(){var w=n("#editor_mode").val(),r=n("#rc-psi"),u=n("#rc-psc"),f=n("#rc-psd"),v=n("#title"),h=n("#place_id").val(),b=n("#upload-file-button"),k=n("#uploading"),d=n("#uploading-help"),g=n("#load_img"),e,c=0,y=n("#ads-grid"),l=samEditorOptions.samStatsUrl,a=samEditorOptions.labels;e=samEditorOptions.places;e.pointer="places";t.init();v.tooltip({track:!0});var p=samEditorOptions.options,i,o=[],s={animate:!0,animateReplot:!0,cursor:{showTooltip:!1},series:[{pointLabels:{show:!0},renderer:n.jqplot.BarRenderer,showHighlight:!1,rendererOptions:{animation:{speed:2500},barWidth:15,barPadding:-15,barMargin:0,highlightMouseOver:!1},label:a.hits},{label:a.clicks,rendererOptions:{animation:{speed:2e3}}}],axesDefaults:{pad:0},axes:{xaxis:{tickInterval:1,drawMajorGridlines:!1,drawMinorGridlines:!0,drawMajorTickMarks:!1,rendererOptions:{tickInset:1,minorTicks:1},min:1},yaxis:{rendererOptions:{forceTickAt0:!0}}},highlighter:{show:!0,showLabel:!0,tooltipAxes:"y",sizeAdjust:7.5,tooltipLocation:"ne",useAxesFormatters:!1,tooltipFormatString:a.clicks+": %d"},legend:{show:!0,placement:"ne"}};return n.post(l,{action:"load_stats",id:h,sm:c}).done(function(t){o=[t.hits,t.clicks];n("#total_hits").text(t.total.hits);n("#total_clicks").text(t.total.clicks);i=n.jqplot("graph",o,s)}),n("#tabs").tabs({activate:function(t,r){var u=r.newPanel[0].id;u=="tabs-3"&&i&&(i.destroy(),i=n.jqplot("graph",o,s))}}),n(window).resize(function(){i&&(i.destroy(),i=n.jqplot("graph",o,s))}),n("#image_tools").tabs(),n.post(l,{action:"load_ads",id:h,sm:0}).done(function(n){var t=n.records;y.w2grid({name:"ads",show:{selectColumn:!1},multiSelect:!1,columns:samEditorOptions.columns,records:t})}),n("#add-file-button").click(function(){var t=p.url+n("select#files_list option:selected").val();return n("#patch_img").val(t),!1}),n("#patch_source_image").click(function(){r.is(":hidden")&&r.show("blind",{direction:"vertical"},500);u.is(":visible")&&u.hide("blind",{direction:"vertical"},500);f.is(":visible")&&f.hide("blind",{direction:"vertical"},500)}),n("#patch_source_code").click(function(){r.is(":visible")&&r.hide("blind",{direction:"vertical"},500);u.is(":hidden")&&u.show("blind",{direction:"vertical"},500);f.is(":visible")&&f.hide("blind",{direction:"vertical"},500)}),n("#patch_source_dfp").click(function(){r.is(":visible")&&r.hide("blind",{direction:"vertical"},500);u.is(":visible")&&u.hide("blind",{direction:"vertical"},500);f.is(":hidden")&&f.show("blind",{direction:"vertical"},500)}),(e.enabled||""==v.val())&&n("#title").pointer({content:"<h3>"+e.title+"<\/h3><p>"+e.content+"<\/p>",position:"top",close:function(){n.ajax({url:ajaxurl,data:{action:"close_sam_pointer",pointer:e.pointer},async:!0})}}).pointer("open"),n("#stats_month").change(function(){c=n(this).val();n.post(l,{action:"load_stats",id:h,sm:c}).done(function(t){o=[t.hits,t.clicks];n("#total_hits").text(t.total.hits);n("#total_clicks").text(t.total.clicks);i&&(i.destroy(),i=n.jqplot("graph",o,s))})}),!1})})(jQuery)